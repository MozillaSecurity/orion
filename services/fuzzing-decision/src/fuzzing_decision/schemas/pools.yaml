$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://github.com/MozillaSecurity/orion/raw/master/services/fuzzing-decision/src/fuzzing_decision/schemas/pools.yaml"
title: "Pool"
type: object
required:
  - name
additionalProperties: false
properties:
  apply_to:
    type: array
    items:
      type: string
  artifacts:
    type: object
    patternProperties:
      ^.*$:
        type: object
        additionalProperties: false
        properties:
          type:
            type: string
            pattern: "^file|directory$"
          url:
            type: string
            pattern: "^[A-Za-z0-9_-]+(/[A-Za-z0-9_.-]+)+$"
  cloud:
    type: string
    pattern: "^aws|azure|gcp|static$"
  command:
    type: array
    items:
      type: string
  container:
    oneOf:
      - type: string
      - type: object
        additionalProperties: false
        properties:
          name:
            type: string
          type:
            type: string
            pattern: "^docker-image$"
        required:
          - type
          - name
      - type: object
        additionalProperties: false
        properties:
          namespace:
            type: string
          path:
            type: string
          type:
            type: string
            pattern: "^indexed-image$"
        required:
          - type
          - namespace
          - path
      - type: object
        additionalProperties: false
        properties:
          taskId:
            type: string
          path:
            type: string
          type:
            type: string
            pattern: "^task-image$"
        required:
          - type
          - taskId
          - path
  cpu:
    type: string
    pattern: "^(x64|x86[_-]64|amd64|aarch64|arm64)$"
  cycle_time:
    type: string
    pattern: "^(\\d+|(\\d+[sSmMhHdDwW])+)$"
  demand:
    type: boolean
  disk_size:
    type: string
    pattern: "^(\\d+\\.\\d+|\\d+)[kKmMgGtT]?[bB]?$"
  env:
    type: object
    additionalProperties: false
    patternProperties:
      ^.*$:
        type:
          - string
          - integer
  imageset:
    type: string
  machine_types:
    type: array
    items:
      type: string
  max_run_time:
    pattern: "^(\\d+|(\\d+[sSmMhHdDwW])+)$"
  name:
    type: string
  nested_virtualization:
    type: boolean
  routes:
    type: array
    items:
      type: string
      pattern: "^notify\\.(email|pulse|matrix-room|slack-channel)\\..+?on-(exception|failed)$"
  parents:
    type: array
    items:
      type: string
  platform:
    type: string
    pattern: "^(linux|windows|macos)$"
  preprocess:
    type: string
  run_as_admin:
    type: boolean
  schedule_start:
    type: string
    format: "date-time"
  scopes:
    type: array
    items:
      type: string
      pattern: "^[A-Za-z0-9:_/-]+$"
  tasks:
    type: integer
  worker:
    type: string
    pattern: "^(d2g|docker|generic)$"
